---
title: "Home Court Advantage & the COVID No-Fan Season in College Basketball"
author: "Marco Parcella, Callen Bronson, Justin Huebner"
date: "2026-03-01"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)
```

## Research Question

How did the COVID-19 no-fan season (2020-21) change home court advantage and team performance in college basketball?

When fans were removed from arenas, the psychological and acoustic advantages that home teams rely on disappeared overnight. We use five seasons of NCAA data (2018-2022) to measure exactly how much changed — in win rates, scoring margins, shooting efficiency, and game dynamics.

---

## 1. Load Data & Setup

```{r load}
library(dplyr)
library(ggplot2)

df <- read.csv("~/Downloads/Spreadsheets/ncaa_2018_2022_clean.csv")

# flag covid season
df$covid <- ifelse(df$season == 2021, "COVID (No Fans)", "Normal Season")

# each game appears twice (one row per team) — separate home and away
home <- df %>% filter(team_home_away == "home")
away <- df %>% filter(team_home_away == "away")

cat("Total rows:", nrow(df), "\n")
cat("Seasons:", paste(sort(unique(df$season)), collapse = ", "), "\n")
cat("Teams:", length(unique(df$team_name)), "\n")
```

---

## 2. Data Cleaning

```{r clean}
cat("Rows before cleaning:", nrow(df), "\n")

# season_type 2 = regular season, 3 = tournament (March Madness)
# keep both but flag them so we can separate if needed
cat("Regular season rows:", sum(df$season_type == 2), "\n")
cat("Tournament rows:", sum(df$season_type == 3), "\n")
df$game_type <- ifelse(df$season_type == 3, "Tournament", "Regular Season")

# remove any rows with clearly bad scores (below 20 is unrealistic for a full game)
bad_scores <- sum(df$team_score < 20)
cat("Rows with score < 20 (dropping):", bad_scores, "\n")
df <- df %>% filter(team_score >= 20)

# attendance = 0 in non-covid years means ESPN has no data, not an empty arena
# keep for general analysis but drop for attendance-specific plots
df_with_att <- df %>% filter(attendance > 0)
home_with_att <- df_with_att %>% filter(team_home_away == "home")

cat("Rows dropped for missing attendance:", nrow(df) - nrow(df_with_att), "\n")
cat("Rows after all cleaning:", nrow(df), "\n")

# re-separate home and away after cleaning
home <- df %>% filter(team_home_away == "home")
away <- df %>% filter(team_home_away == "away")
```

---

## 3. Home Court Advantage: Did It Disappear?

```{r home_win_rate}
home_win_rate <- home %>%
  group_by(season, covid) %>%
  summarise(
    games = n(),
    wins = sum(team_winner == "True"),
    win_rate = wins / games
  )

print(home_win_rate)

ggplot(home_win_rate, aes(x = factor(season), y = win_rate, fill = covid)) +
  geom_bar(stat = "identity") +
  geom_hline(yintercept = 0.5, linetype = "dashed", color = "black") +
  scale_fill_manual(values = c("COVID (No Fans)" = "#d73027", "Normal Season" = "#4575b4")) +
  labs(
    title = "Home Win Rate by Season",
    subtitle = "Dashed line = 50% (no home advantage)",
    x = "Season", y = "Home Win Rate", fill = ""
  ) +
  ylim(0, 0.75) +
  theme_minimal()
```

---

## 4. Point Margin: Did Games Get Closer?

```{r margin}
# join home and away to get both scores in one row
margins <- home %>%
  select(game_id, season, covid, home_score = team_score, home_win = team_winner) %>%
  left_join(
    away %>% select(game_id, away_score = team_score),
    by = "game_id"
  ) %>%
  mutate(margin = home_score - away_score)

avg_margin <- margins %>%
  group_by(season, covid) %>%
  summarise(avg_margin = mean(margin, na.rm = TRUE))

print(avg_margin)

ggplot(avg_margin, aes(x = factor(season), y = avg_margin, fill = covid)) +
  geom_bar(stat = "identity") +
  geom_hline(yintercept = 0, linetype = "dashed") +
  scale_fill_manual(values = c("COVID (No Fans)" = "#d73027", "Normal Season" = "#4575b4")) +
  labs(
    title = "Average Home Team Point Margin by Season",
    subtitle = "Positive = home team wins by X points on average",
    x = "Season", y = "Average Margin (Home - Away)", fill = ""
  ) +
  theme_minimal()
```

---

## 5. Shooting Efficiency: Home vs. Away FG% Gap

```{r shooting}
shooting <- df %>%
  group_by(season, covid, team_home_away) %>%
  summarise(
    avg_fg_pct  = mean(field_goal_pct, na.rm = TRUE),
    avg_ft_pct  = mean(free_throw_pct, na.rm = TRUE)
  )

fg_gap <- shooting %>%
  select(season, covid, team_home_away, avg_fg_pct) %>%
  tidyr::pivot_wider(names_from = team_home_away, values_from = avg_fg_pct) %>%
  mutate(fg_gap = home - away)

print(fg_gap)

ggplot(fg_gap, aes(x = factor(season), y = fg_gap, fill = covid)) +
  geom_bar(stat = "identity") +
  geom_hline(yintercept = 0, linetype = "dashed") +
  scale_fill_manual(values = c("COVID (No Fans)" = "#d73027", "Normal Season" = "#4575b4")) +
  labs(
    title = "Home vs. Away FG% Gap by Season",
    subtitle = "How much better did home teams shoot compared to away teams?",
    x = "Season", y = "FG% Gap (Home - Away)", fill = ""
  ) +
  theme_minimal()
```

---

## 6. Free Throw % Gap (Crowd Effect)

Crowd noise is known to rattle away players at the free throw line. This gap should shrink in 2021.

```{r free_throws}
ft_gap <- shooting %>%
  select(season, covid, team_home_away, avg_ft_pct) %>%
  tidyr::pivot_wider(names_from = team_home_away, values_from = avg_ft_pct) %>%
  mutate(ft_gap = home - away)

print(ft_gap)

ggplot(ft_gap, aes(x = factor(season), y = ft_gap, fill = covid)) +
  geom_bar(stat = "identity") +
  geom_hline(yintercept = 0, linetype = "dashed") +
  scale_fill_manual(values = c("COVID (No Fans)" = "#d73027", "Normal Season" = "#4575b4")) +
  labs(
    title = "Home vs. Away Free Throw % Gap by Season",
    x = "Season", y = "FT% Gap (Home - Away)", fill = ""
  ) +
  theme_minimal()
```

---

## 7. Total Scoring by Season

```{r scoring}
total_scoring <- margins %>%
  mutate(total_points = home_score + away_score) %>%
  group_by(season, covid) %>%
  summarise(avg_total = mean(total_points, na.rm = TRUE))

print(total_scoring)

ggplot(total_scoring, aes(x = factor(season), y = avg_total, fill = covid)) +
  geom_bar(stat = "identity") +
  scale_fill_manual(values = c("COVID (No Fans)" = "#d73027", "Normal Season" = "#4575b4")) +
  labs(
    title = "Average Total Points Per Game by Season",
    x = "Season", y = "Avg Total Points", fill = ""
  ) +
  ylim(0, 160) +
  theme_minimal()
```

---

## 8. Attendance vs. Home Margin

```{r attendance_scatter}
margins_att <- margins %>%
  left_join(home_with_att %>% select(game_id, attendance), by = "game_id") %>%
  filter(!is.na(attendance))

ggplot(margins_att, aes(x = attendance, y = margin, color = covid)) +
  geom_point(alpha = 0.2, size = 0.8) +
  geom_smooth(method = "lm", se = FALSE) +
  scale_color_manual(values = c("COVID (No Fans)" = "#d73027", "Normal Season" = "#4575b4")) +
  labs(
    title = "Attendance vs. Home Team Point Margin",
    subtitle = "Does a bigger crowd help the home team win by more?",
    x = "Attendance", y = "Home Margin (Home - Away)", color = ""
  ) +
  theme_minimal()
```

---

## 9. Distribution of Margins

```{r margin_dist}
ggplot(margins, aes(x = factor(season), y = margin, fill = covid)) +
  geom_boxplot(outlier.size = 0.5) +
  geom_hline(yintercept = 0, linetype = "dashed") +
  scale_fill_manual(values = c("COVID (No Fans)" = "#d73027", "Normal Season" = "#4575b4")) +
  labs(
    title = "Distribution of Home Team Point Margins by Season",
    x = "Season", y = "Margin (Home - Away)", fill = ""
  ) +
  theme_minimal()
```

---

## 10. Subgroup: Close Games vs. Blowouts

```{r subgroup}
margins <- margins %>%
  mutate(game_type = case_when(
    abs(margin) <= 5  ~ "Close (<=5 pts)",
    abs(margin) <= 15 ~ "Medium (6-15 pts)",
    TRUE              ~ "Blowout (>15 pts)"
  ))

subgroup <- margins %>%
  group_by(season, covid, game_type) %>%
  summarise(
    games = n(),
    home_win_rate = mean(home_win == "True")
  )

ggplot(subgroup, aes(x = factor(season), y = home_win_rate, fill = covid)) +
  geom_bar(stat = "identity", position = "dodge") +
  facet_wrap(~ game_type) +
  geom_hline(yintercept = 0.5, linetype = "dashed") +
  scale_fill_manual(values = c("COVID (No Fans)" = "#d73027", "Normal Season" = "#4575b4")) +
  labs(
    title = "Home Win Rate by Game Type and Season",
    x = "Season", y = "Home Win Rate", fill = ""
  ) +
  theme_minimal()
```

---

## 11. Summary Table

```{r summary_table}
summary_stats <- df %>%
  group_by(covid, team_home_away) %>%
  summarise(
    avg_score     = round(mean(team_score, na.rm = TRUE), 1),
    avg_fg_pct    = round(mean(field_goal_pct, na.rm = TRUE), 1),
    avg_ft_pct    = round(mean(free_throw_pct, na.rm = TRUE), 1),
    avg_3pt_pct   = round(mean(three_point_field_goal_pct, na.rm = TRUE), 1),
    avg_turnovers = round(mean(turnovers, na.rm = TRUE), 1)
  )

print(summary_stats)
```

---

## 12. Conclusions

```{r conclusions}
normal_home_wr <- home_win_rate %>% filter(covid == "Normal Season") %>% pull(win_rate) %>% mean()
covid_home_wr  <- home_win_rate %>% filter(covid == "COVID (No Fans)") %>% pull(win_rate)
normal_margin  <- avg_margin %>% filter(covid == "Normal Season") %>% pull(avg_margin) %>% mean()
covid_margin   <- avg_margin %>% filter(covid == "COVID (No Fans)") %>% pull(avg_margin)

cat("Normal seasons avg home win rate:", round(normal_home_wr, 3), "\n")
cat("COVID season home win rate:",       round(covid_home_wr, 3), "\n")
cat("Normal seasons avg home margin:",   round(normal_margin, 2), "pts\n")
cat("COVID season avg home margin:",     round(covid_margin, 2), "pts\n")
```

**Key Findings:**

- Home win rate dropped from ~X% in normal seasons to ~Y% in 2021
- Average home margin fell from ~X pts to ~Y pts
- FG% and FT% shooting gaps between home and away teams narrowed in 2021, consistent with the crowd noise effect being removed
- The effect was most pronounced in close games, where crowd psychology matters most
